# 4장 좋은 테스트의 4대 요소
좋은 단위 테스트 스위트의 특성
- 개발 주기에 통합돼 있다.
- 코드베이스의 가장 중요한 부분만을 대상으로 한다.
- 최소한의 유지비로 최대 가치를 끌어 낸다.
  - 가치있는 테스트 식별  
  - 가치있는 테스트 작성

### 4.1 좋은 단위 테스트의 4대 요소 자세히 살펴보기
- 회귀 방지
- 리팩터링 내성
- 빠른 피드백
- 유지 보수성

**첫 번째 요소: 회귀 방지**  
회귀는 코드를 수정한 후 기능이 의도한 대로 작동하지 않는 경우로 소프트웨어 버그다.  
회귀 방지 차원에서 가치있는 테스트란 다음 사항을 고려해야 한다.  
- 테스트 중에 실행되는 코드의 양 -> 많을 수록 회귀가 나타날 가능 성이 높다.
- 코드 복잡도 -> 단순한 코드는 회귀가 잘 나타나지 않는다.
- 코드의 도메인 유의성 -> 비즈니스에 중요한 기능에 발생한 버그가 큰 피해를 입는다.

**두 번째 요소: 리팩터링 내성**  
리팩터링이란 식별할 수 있는 동작을 수정하지 않고 기존 코드를 변경하는 것을 의미한다.  
기능은 예전과 동일하게 작동하지만 테스트가 빨간색인경우를 거짓 양성이라고 한다.  
거짓 양성은 적을 수록 좋다.  
거짓 양성이 많아지면 유지가능한 테스트를 방해한다.  
- 테스트가 타당한 이유 없이 실패하면 시간이 흐르면서 실패에 익숙해지고 나중에는 신경도 쓰지 않게 된다.
- 거짓 양성이 빈번하면 테스트 스위트에 대한 신뢰가 떨어진다. 신뢰가 부족해지면 리팩터링이 줄어든다.

**구현 세부 사항 대신 최종 결과를 목표로 하기**  
테스트를 깨지지 않게 하고 리팩터링 내성을 높이는 방법은   
구현 세부 사항과 테스트 간의 결합도를 낮추는 것이다.  

### 4.2 첫 번째 특성과 두 번째 특성 간의 본질적인 관계
**테스트 정확도 극대화**  
- 정확도의 지표  
  - 테스트가 버그 있음을 얼마나 잘 나타내는가  
  - 테스트가 버그 없음을 얼마나 잘 나타내는가    
  
테스트의 정확도 = 신호(발견된 버그수) / 소음(허위 경보 발생수)  

테스트의 정확도를 향상 시키기 위해서는   
첫번째, 신호를 증가시켜야 한다. 즉 회귀를 더 잘 찾는 테스트로 개선하는 것이다. (= 회귀 방지)  
두번째, 소음을 줄여야 한다. 즉 허위 경보를 발생시키 지 않는 테스트로 개선하는 것이다. (= 리팩터링 내성)  

### 4.3 세 번째 요소와 네 번째 요소: 빠른 피드백과 유지 보수성
**빠른 피드백**  
테스트 속도가 빠를 수록  
더 많은 테스트를 수행할 수 있고 더 자주 실행할 수 있고  
피드백 루프를 줄여 코드에 결함이 생기자마자 버그를 수정할 수 있다.  

**유지 보수성**
- 테스트가 얼마나 이해하기 어려운가  
테스트 코드 라인이 적을수록 읽기 쉽다.
- 테스트가 얼마나 실행하기 어려운가  
  외부 족속성이 있으면 시간이 걸린다.

### 4.4 이상적인 테스트를 찾아서
좋은 단위 테스트의 4대 특성
- 회귀 방지
- 리팩터링 내성
- 빠른 피드백
- 유지 보수성

**이상적인 테스트를 만들 수 있는가?**  
네 가지 특성 모두에서 최대 점수를 받는 테스트는 거의 불가능하다.  
따라서 특성 중 어느 것도 크게 줄지 않는 방식으로 최대한 크게 해야 한다.  

**극단적인 사례 1:엔트 투 엔드 테스트**  
엔트 투 엔드 테스트는 일반적으로 UI, 데이터베이스, 외부 애플리케이션을 포함한 모든 시스템 구성요소를 거치게 된다.  
많은 코드 테스트를 하므로 회귀 방지와 리팩터링 내구성도 우수하다.  
하지만 단점은 느린 속도로 빠른 피드백을 받기 어렵다.  

**극단적인 사례 2:간단한 테스트**  
간단한 테스트는 매우 빠르게 실행되고 빠른 피드백을 제공한다.    
거짓 양성이 생길 가능성이 낮아 리팩터링 내성도 우수하다.  
하지만 실수할 여지가 없어 회귀를 테스트 할 수 없다.  

**극단적인 사례 3:깨지기 쉬운 테스트**  
깨지기 쉬운 테스트란 실행이 빠르고 회귀를 잡을 가능성이 높지만  
거짓양성이 많은 테스트를 말한다.  
즉 리팩터링 내성이 거의 없다.

**이상적인 테스트를 찾아서: 결론**  
<img src = "https://velog.velcdn.com/images%2Fmabr2845%2Fpost%2F2842b8d7-db76-4b44-903a-f6a2383dba57%2Fimage.png"><br/>

세 가지 특성이 모두 완벽한 점수를 가진 이상적인 테스트를 만드는 것은 불가능하다.
어떻게 희생 할까?   
회귀 방지, 리팩터링 내성, 빠른 피드백의 상호 배타성 때문에 세 가지 특성을 모두 양보해야 한다.  
하지만 리팩터링 내성을 최대한 많이 갖는 것을 목표로 해야한다.   
(리팩트링 내성은 테스트에서 있거나 없거나 둘중하나다.)  
그후 테스트가 얼마나 버그를 잘 찾아 내는지(회귀 방지)와 얼마나 빠른지 (빠른 피드백)사이의 절충안을 택해야 한다.

### 4.5 대중적인 테스트 자동화 개념 살펴보기
**테스트 피라미드 분해**  
테스트 피라미드는 테스트 스위트에서 테스트 유형 간의 일정한 비율을 말한다.
<img src ="https://velog.velcdn.com/images%2Fmabr2845%2Fpost%2F1534bc79-5a62-440d-8a44-9e1cae123a43%2Fimage.png"></br>

테스트 유형 간의 정확한 비율은 각 팀과 프로젝트 마다 다를 것이다.  
그러나 일반적으로는 피라미드 형태를 유지해야 한다.  
즉 엔드 투 엔드 테스트가 가장 적고, 단위 테스트가 가장 많으며, 통합 테스틑 그 중간 어딘가에 있어야한다.  
어느 계층에서도 리팩터링 내성을 포기 하지 않아야 한다.  
<img src = "https://velog.velcdn.com/images%2Fmabr2845%2Fpost%2F84af15cb-49ed-48b6-8b5f-31422e28c14c%2Fimage.png"><br/>
파라미드의 테스트는 빠른 피드백과 회귀 방지 사이에서 선택한다.   
피라미드의 예외
- 애플리케이션의 비즈니스 규칙이 복잡도가 거의 없다면 (ex: CRUD)  
단위테스트, 통합테스트, 엔드 투 엔드 테스트가 거의 같아 직사각형 형태를 띄게 될것이다.
- 프로젝트 외부 의존성(ex: 데이터 베이스 연결)이 하나만 있다면
엔드 투 엔드 테스트가 통합테스트와 구별할 수 없다.

**블랙박스 테스트와 화이트박스 테스트 간의 선택**
- 블랙박스 테스트는 시스템 내부 구조를 몰라도 시스템 기능 검사할 수 있는 테스트 방법이다.  
애플리케이션이 무엇을 해야 하는지를 중심으로 구축된다. 


- 화이트 테스트는 애플리케이션의 내부 작업을 겁증한다.  
테스트는 요구사항나 명세가 아닌 소스 코드에서 파생 된다.
    - 장점 : 더 철저하며 외부 명세에서 놓칠 수 있는 오류를 발견할 수 있다.
    - 단점 : 대상 코드의 특정 구현과 결합되어 있어 깨지기 쉽다.  
      거짓 양성을 많이 내고 리팩터링 내성 지표가 부족하다.

리팩터링 내성은 타협할 수 없으므로 블랙박스 테스트를 기본으로 선택해야한다.  
테스트 작성은 블랙박스 테스트를  
테스트 분석할 때는 화이트박스 테스트를 사용할 수 있다.  
